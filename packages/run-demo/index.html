<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title><%- title %></title>
    <link rel="stylesheet" href="index.css">
  <script>

  async function getTemplate(filepath) {
      let response = await fetch(filepath);
      let txt = await response.text();
      return new DOMParser().parseFromString(txt, 'text/html');
  }

  // Function to inline HTML imports recursively
  async function inlineHtmlImports(parentNode) {
    var nl = parentNode.querySelectorAll('link[rel="import"]');
    for (var i = 0; i < nl.length; ++i) {
      var node = nl[i];
      
      const doc = await getTemplate(node.href);

      await inlineHtmlImports(doc)
      
      var content = doc.querySelectorAll('body > *');
      // Hack to convert nodelist to real JS-array
      content = Array.prototype.slice.call(content);
      content.map(function(node) {
        parentNode.body.appendChild(node.cloneNode(true));
      });
      if (i + 1 < nl.length) {
        parentNode.body.appendChild(parentNode.createElement('br'));
        parentNode.body.appendChild(parentNode.createElement('br'));
      }
    }
  }
  </script>
</head>
<body onload="inlineHtmlImports(document);">

<link rel="import" href="example.html">

</body>
</html>
